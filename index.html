<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Generador de Script GEE (1990‚Äì2024)</title>
  <style>
    body { font-family: sans-serif; margin: 2em; max-width: 900px; }
    label { display: block; margin-top: 1em; font-weight: bold; }
    input { width: 100%; padding: 0.5em; font-size: 1em; }
    #map { height: 400px; margin: 1em 0; border: 1px solid #ccc; }
    textarea { width: 100%; height: 400px; font-family: monospace; font-size: 0.9em; margin-top: 1em; }
    button { padding: 0.6em 1.2em; margin-top: 1em; cursor: pointer; }
    .enlace { margin-top: 1em; font-size: 0.95em; }
  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
</head>
<body>
  <h1>Script GEE para an√°lisis 1990‚Äì2024</h1>
  <p>Este generador permite seleccionar un punto y un radio de an√°lisis para aplicar el script de extracci√≥n de l√≠neas de costa desde 1990 a 2024 (Landsat y Sentinel-2).</p>

  <label for="lon">Longitud del punto central:</label>
  <input type="number" id="lon" value="-55.70237" step="any">

  <label for="lat">Latitud del punto central:</label>
  <input type="number" id="lat" value="-34.78015" step="any">

  <label for="radio">Radio del c√≠rculo de an√°lisis (en metros):</label>
  <input type="number" id="radio" value="2000">

  <div id="map"></div>

  <button onclick="generarCodigo()">Generar c√≥digo</button>
  <button onclick="copiarCodigo()">üìã Copiar al portapapeles</button>

  <div class="enlace">
    ‚û°Ô∏è Luego de copiar el script, ve a <a href="https://code.earthengine.google.com/" target="_blank">Google Earth Engine</a> y p√©galo all√≠ para ejecutarlo.
  </div>

  <textarea id="codigo" readonly placeholder="Aqu√≠ aparecer√° el script..."></textarea>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    window.addEventListener('load', function() {
      const mapa = L.map('map').setView([-34.78015, -55.70237], 13);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(mapa);

      let marcador = L.marker([-34.78015, -55.70237], { draggable: false }).addTo(mapa);

      mapa.on('click', function(e) {
        const { lat, lng } = e.latlng;
        document.getElementById("lat").value = lat.toFixed(6);
        document.getElementById("lon").value = lng.toFixed(6);
        marcador.setLatLng([lat, lng]);
        generarCodigo();
      });

      generarCodigo();
    });

    async function generarCodigo() {
      const lon = parseFloat(document.getElementById("lon").value);
      const lat = parseFloat(document.getElementById("lat").value);
      const radio = parseInt(document.getElementById("radio").value);
      const raw = await fetch("https://raw.githubusercontent.com/gaitapi/linea-costa-solis-chico/main/linea_costa_solis_chico.js")
        .then(r => r.text());

      const reemplazado = raw
        .replace(/var centro = ee\.Geometry\.Point\([^\)]+\);/, `var centro = ee.Geometry.Point([${lon}, ${lat}]);`)
        .replace(/var radio_m = \d+;/, `var radio_m = ${radio};`);

      document.getElementById("codigo").value = reemplazado;
    }

    function copiarCodigo() {
      const area = document.getElementById("codigo");
      area.select();
      area.setSelectionRange(0, 99999);
      document.execCommand("copy");
    }
  </script>
</body>
</html>
