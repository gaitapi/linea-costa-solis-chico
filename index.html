<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Generador de Script GEE (1990‚Äì2024)</title>
  <style>
    body { font-family: sans-serif; margin: 2em; max-width: 800px; }
    label { display: block; margin: 1em 0 0.5em; font-weight: bold; }
    input { width: 100%; padding: 0.5em; font-size: 1em; }
    textarea { width: 100%; height: 400px; margin-top: 1em; font-family: monospace; font-size: 0.9em; }
    button { padding: 0.6em 1.2em; margin-top: 1em; cursor: pointer; }
    .enlace { margin-top: 1em; font-size: 0.9em; }
    #mapa { height: 300px; margin-top: 1em; }
  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
  <h1>Script GEE para an√°lisis 1990‚Äì2024</h1>
  <p>Este generador permite ajustar el punto central y radio de an√°lisis para aplicar el script de extracci√≥n de l√≠neas de costa desde 1990 a 2024 (Landsat y Sentinel-2).</p>

  <label for="lon">Longitud del punto central:</label>
  <input type="number" id="lon" value="-55.70237" step="any">

  <label for="lat">Latitud del punto central:</label>
  <input type="number" id="lat" value="-34.78015" step="any">

  <label for="radio">Radio del c√≠rculo de an√°lisis (en metros):</label>
  <input type="number" id="radio" value="2000">

  <div id="mapa"></div>

  <button onclick="generarCodigo()">Generar c√≥digo</button>
  <button onclick="copiarCodigo()">üìã Copiar al portapapeles</button>

  <div class="enlace">
    ‚û°Ô∏è Luego de copiar el script, ve a <a href="https://code.earthengine.google.com/" target="_blank">Google Earth Engine</a> y p√©galo all√≠ para ejecutarlo.
  </div>

  <textarea id="codigo"></textarea>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    function dibujarMapa() {
      const lon = parseFloat(document.getElementById("lon").value);
      const lat = parseFloat(document.getElementById("lat").value);
      const radio = parseInt(document.getElementById("radio").value);

      const mapa = L.map('mapa').setView([lat, lon], 13);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(mapa);

      L.circle([lat, lon], {
        radius: radio,
        color: 'blue',
        fillOpacity: 0.1
      }).addTo(mapa);

      mapa.on('click', function(e) {
        const { lat, lng } = e.latlng;
        document.getElementById("lat").value = lat.toFixed(6);
        document.getElementById("lon").value = lng.toFixed(6);
        document.getElementById("codigo").value = "";  // limpia c√≥digo viejo
        mapa.remove();
        dibujarMapa(); // redibuja
      });
    }

    async function generarCodigo() {
      const lon = parseFloat(document.getElementById("lon").value);
      const lat = parseFloat(document.getElementById("lat").value);
      const radio = parseInt(document.getElementById("radio").value);
      const raw = await fetch("https://raw.githubusercontent.com/gaitapi/linea-costa-solis-chico/main/linea_costa_solis_chico.js")
        .then(r => r.text());

      const reemplazado = raw
        .replace(/var centro = ee\.Geometry\.Point\([^\)]+\);/, `var centro = ee.Geometry.Point([${lon}, ${lat}]);`)
        .replace(/var radio_m = \d+;/, `var radio_m = ${radio};`);

      document.getElementById("codigo").value = reemplazado;
    }

    function copiarCodigo() {
      const area = document.getElementById("codigo");
      area.select();
      area.setSelectionRange(0, 99999);
      document.execCommand("copy");
    }

    // inicializa mapa al cargar la p√°gina
    window.onload = dibujarMapa;
  </script>
</body>
</html>
